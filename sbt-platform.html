<!DOCTYPE html>
<html class="no-js" lang="eng" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Platform sbt plugin</title>
    <link rel="stylesheet" href="_theme/css/foundation.min.css">
    <link rel="stylesheet" href="_theme/css/app.css">
     <link rel="stylesheet" href="_theme/css/highlight.js/styles/github-gist.css"> 
  </head>
  <body>
    <div class="expanded row">
      <div class="small-12 medium-12 large-12 columns align-self-top">
        <div class="row">
          
          <header class="large-12 columns align-self-top a_header">
            <div class="row">
              <div class="large-12 columns a_limited top-bar">
                <div class="top-bar-left">
                  <p>The Scala Platform</p>

                </div>
                <div class="top-bar-right align-right row">
                  
                  
                    <form action="site-search.html" method="get" class="align-right a_search">
                      <input name="q" type="search"  placeholder="Search
" >
                      <button><img alt="&#1F50D;" src="_theme/images/images/search.svg" /></button>
                    </form>
                  
                </div>
              </div>
            </div>
          </header>
          
          <div class="small-12 medium-12 large-12 columns align-self-top a_limited a_main">
            <div class="row">
              
              <main class="columns large-order-2 sections" id="_sections">
                <h1 id="the-platform-sbt-plugin" class="a_section" data-magellan-target="the-platform-sbt-plugin">The Platform sbt plugin<a class="a_hlink" href="#the-platform-sbt-plugin"></a></h1>
<p><strong>sbt-platform</strong> is a SBT plugin that aims at simplifying the maintenance
and release of Scala Platform modules. It automates common use cases to
speed up developers' workflow and let module maintainers focus on the essential.</p>
<p>Add it to your project (<code class="hljs">project/plugins.sbt</code>) with:</p>
<div class="row">
<pre class="hljs small-expand columns a_xscroll"><code class="language-scala">addSbtPlugin(<span class="hljs-string">"ch.epfl.scala"</span> % <span class="hljs-string">"sbt-platform"</span> % <span class="hljs-string">"0.2.0"</span>)
</code></pre>
</div>
<p>The <code class="hljs">sbt-platform</code> plugin provides a tight integration with the Scala Platform CI
server and infrastructure. For now, it covers the following use cases:</p>
<ul>
<li>Automatic release of nightlies.</li>
<li>Automatic release of stable versions when a git tag is found.</li>
<li>MiMa compatibility checks and PGP signatures for artifacts (with Scala Platform keys).</li>
<li>Integration with our Drone setup for writing your own sbt scripts.</li>
<li>Automatic detection of cumbersome sbt keys (e.g. <code class="hljs">scmInfo</code>).</li>
<li>Automatic configuration of common sbt plugins:
<ul>
<li><code class="hljs">sbt-bintray</code></li>
<li><code class="hljs">sbt-pgp</code></li>
<li><code class="hljs">sbt-release</code></li>
<li><code class="hljs">sbt-mima-plugin</code></li>
<li><code class="hljs">sbt-coursier</code></li>
</ul>
</li>
</ul>
<p>Together with <a href="ci-integration.html">our CI</a>, the plugin aims to provide a complete
developer experience with good error detection.</p>
<h2 id="next-steps" class="a_section" data-magellan-target="next-steps">Next steps<a class="a_hlink" href="#next-steps"></a></h2>
<p>As <code class="hljs">sbt-platform</code> is still <em>work in progress</em>, we're open to suggestions
on improving Scala Platform modules' maintainers. Our potential next steps are:</p>
<ul>
<li>Adding support for Sonatype.</li>
<li>Releasing to more than one Maven/Ivy repository (Scala Platform's and your personal one).</li>
<li>Extending the default release steps for every process.</li>
<li>Adding release processes for release candidates and milestones.</li>
<li>Adding smart test execution based on changes in git commits, i.e. instead of
running <code class="hljs">sbt test</code> for all the projects, run it only for the affected subprojects.</li>
<li>Improving MiMa binary compatibility checks.</li>
<li>Adding source compatibility checks using Scala Meta.</li>
</ul>
<p>If any of the previous features calls your attention, feel free to help out and make a PR.
<code class="hljs">sbt-platform</code> follows the same <a href="https://github.com/scalacenter/platform-staging/CONTRIBUTING.md">CONTRIBUTION</a>
guidelines than the Scala Platform process.</p>
<blockquote class="note">
<p>We hope to improve the infrastructure and the maintainers support as the Scala Platform
grows and the community gets involved. This plugin only provides support for a basic subset
of features that improve maintainers' life. We expect to enrich this subset with
maintainers' input.</p>
</blockquote>
<h2 id="usage" class="a_section" data-magellan-target="usage">Usage<a class="a_hlink" href="#usage"></a></h2>
<p><code class="hljs">sbt-platform</code> defines two main commands:</p>
<div class="row"><div class="small-expand columns a_xscroll a_table"><table>
<thead>
<tr><th>Platform</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>releaseNightly</td><td>Release a nightly version of the module.</td></tr>
<tr><td>releaseStable</td><td>Release a stable version of the module.</td></tr>
</tbody>
</table></div></div>
<h3 id="examples-of-use" class="a_section" data-magellan-target="examples-of-use">Examples of use<a class="a_hlink" href="#examples-of-use"></a></h3>
<div class="row">
<pre class="hljs small-expand columns a_xscroll"><code class="language-sql">releaseNightly [<span class="hljs-keyword">release</span>-<span class="hljs-keyword">version</span> &lt;<span class="hljs-keyword">version</span>&gt;] [<span class="hljs-keyword">skip</span>-tests] [<span class="hljs-keyword">cross</span>]
releaseStable [<span class="hljs-keyword">release</span>-<span class="hljs-keyword">version</span> &lt;<span class="hljs-keyword">version</span>&gt;] [<span class="hljs-keyword">skip</span>-tests] [<span class="hljs-keyword">cross</span>]
</code></pre>
</div>
<p>All the arguments are optional and <code class="hljs">&lt;&gt;</code> represents the parameters.</p>
<p>Release commands are executed by the CI. To set it up, check
the <a href="sbt-platform.html">CI documentation</a>.</p>
<h2 id="setup" class="a_section" data-magellan-target="setup">Setup<a class="a_hlink" href="#setup"></a></h2>
<p><code class="hljs">sbt-platform</code> already comes with a default setup, thought out to get
you started as soon as possible. You only need to make sure that
<a href="ci-integration.html">the integration with the CI works</a>.</p>
<p>However, you may find interesting changing the value of some sbt keys.
The general syntax for this is:</p>
<div class="row">
<pre class="hljs small-expand columns a_xscroll"><code class="language-scala">nameOfSbtSettingOrTask := {
  <span class="hljs-comment">// Write here Scala code that returns a value</span>
  <span class="hljs-comment">// according to the type of the settings or task</span>
}
</code></pre>
</div>
<h3 id="common-general-settings-and-tasks" class="a_section" data-magellan-target="common-general-settings-and-tasks">Common general settings and tasks<a class="a_hlink" href="#common-general-settings-and-tasks"></a></h3>
<p>This section includes the most important settings and tasks of the sbt plugins the <code class="hljs">sbt-platform</code> depends on.</p>
<div class="row"><div class="small-expand columns a_xscroll a_table"><table>
<thead>
<tr><th>Settings</th><th>Description</th><th>Type</th><th>Default</th></tr>
</thead>
<tbody>
<tr><td>bintrayRepository</td><td>Name of the Bintray repository the artifact will be stored on.</td><td><code class="hljs">String</code></td><td>N/A</td></tr>
<tr><td>bintrayOrganization</td><td>Name of the Bintray organization the repository is in.</td><td><code class="hljs">String</code></td><td><code class="hljs">&quot;scalaplatform&quot;</code></td></tr>
<tr><td>publishArtifact in Test</td><td>Setting to include the test sources in the final released artifact.</td><td><code class="hljs">Boolean</code></td><td><code class="hljs">false</code></td></tr>
</tbody>
</table></div></div>
<div class="row"><div class="small-expand columns a_xscroll a_table"><table>
<thead>
<tr><th>Tasks</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>bintraySyncMavenCentral</td><td>Sync bintray-published artifacts with maven central</td></tr>
</tbody>
</table></div></div>
<h3 id="platform-specific-tasks-and-settings" class="a_section" data-magellan-target="platform-specific-tasks-and-settings">Platform-specific tasks and settings<a class="a_hlink" href="#platform-specific-tasks-and-settings"></a></h3>
<p>Aside from reusing the settings and tasks defined by the dependent sbt plugins,
<code class="hljs">sbt-platform</code> defines their own to make easier customize the plugin functionality.</p>
<h3 id="platform-specific-settings" class="a_section" data-magellan-target="platform-specific-settings">Platform-specific settings<a class="a_hlink" href="#platform-specific-settings"></a></h3>
<div class="row"><div class="small-expand columns a_xscroll a_table"><table>
<thead>
<tr><th>Settings</th><th>Description</th><th>Type</th><th>Default</th></tr>
</thead>
<tbody>
<tr><td>platformInsideCi</td><td>Checks if CI is executing the build.</td><td><code class="hljs">Boolean</code></td><td><code class="hljs">false</code></td></tr>
<tr><td>platformCiEnvironment</td><td>Get the Drone environment</td><td><code class="hljs">Option[CIEnvironment]</code></td><td><code class="hljs">None</code></td></tr>
<tr><td>platformReleaseOnMerge</td><td>Release on every PR merge.</td><td><code class="hljs">Boolean</code></td><td><code class="hljs">false</code></td></tr>
<tr><td>platformModuleName</td><td>Name of the module and the bintray package.</td><td><code class="hljs">String</code></td><td>bintrayPackage.value</td></tr>
<tr><td>platformModuleTags</td><td>Tags for the bintray module package.</td><td><code class="hljs">Seq[String]</code></td><td>bintrayPackageLabels.value</td></tr>
<tr><td>platformTargetBranch</td><td>Branch used for the platform release.</td><td><code class="hljs">String</code></td><td><code class="hljs">&quot;platform-release&quot;</code></td></tr>
<tr><td>platformGitHubToken</td><td>Token to publish releases to GitHub.</td><td><code class="hljs">String</code></td><td>N/A</td></tr>
<tr><td>platformReleaseNotesDir</td><td>Directory with the markdown release notes.</td><td><code class="hljs">String</code></td><td><code class="hljs">baseDirectory.value / &quot;notes&quot;</code></td></tr>
<tr><td>platformSignArtifact</td><td>Enable to sign artifacts with the platform pgp key.</td><td><code class="hljs">Boolean</code></td><td><code class="hljs">true</code></td></tr>
<tr><td>platformPgpRings</td><td>Files that store the pgp public and secret ring respectively.</td><td><code class="hljs">Option[(File, File)]</code></td><td>N/A</td></tr>
<tr><td>platformBeforePublishHook</td><td>A hook to customize all the release processes before publishing to Bintray.</td><td><code class="hljs">Task[Unit]</code></td><td>N/A</td></tr>
<tr><td>platformAfterPublishHook</td><td>A hook to customize all the release processes after publishing to Bintray.</td><td><code class="hljs">Task[Unit]</code></td><td>N/A</td></tr>
</tbody>
</table></div></div>
<h3 id="platform-specific-tasks" class="a_section" data-magellan-target="platform-specific-tasks">Platform-specific tasks<a class="a_hlink" href="#platform-specific-tasks"></a></h3>
<div class="row"><div class="small-expand columns a_xscroll a_table"><table>
<thead>
<tr><th>Tasks</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>platformValidatePomData</td><td>Ensure that all the data is available before generating a POM file.</td></tr>
<tr><td>platformCurrentVersion</td><td>Get the current version to be released.</td></tr>
<tr><td>platformLatestPublishedVersion</td><td>Fetch latest published stable version.</td></tr>
<tr><td>platformPreviousArtifacts</td><td>Get <code class="hljs">mimaPreviousArtifacts</code> or fetch latest artifact to run MiMa.</td></tr>
<tr><td>platformNextVersionFun</td><td>Function that decides the next version.</td></tr>
<tr><td>platformRunMiMa</td><td>Run MiMa and report results based on current version.</td></tr>
<tr><td>platformGetReleaseNotes</td><td>Get the correct release notes for a release.</td></tr>
<tr><td>platformReleaseToGitHub</td><td>Create a release in GitHub.</td></tr>
<tr><td>platformActiveReleaseProcess</td><td>The active release process if <code class="hljs">releaseNightly</code> or <code class="hljs">releaseStable</code> has been executed.</td></tr>
<tr><td>platformNightlyReleaseProcess</td><td>The default nightly release process.</td></tr>
<tr><td>platformStableReleaseProcess</td><td>The default stable release process.</td></tr>
</tbody>
</table></div></div>
<h2 id="release-processes" class="a_section" data-magellan-target="release-processes">Release processes<a class="a_hlink" href="#release-processes"></a></h2>
<p>The release process setup relies on <a href="https://github.com/sbt/sbt-release">sbt-release</a>
and follows the <a href="https://github.com/scalacenter/platform-staging">Scala Platform release process</a>.
By using it, modules maintainers can be sure that their practices are valid according to
the spec.</p>
<h3 id="platform-bintray-repositories" class="a_section" data-magellan-target="platform-bintray-repositories">Platform Bintray repositories<a class="a_hlink" href="#platform-bintray-repositories"></a></h3>
<p>The Scala Platform uses Bintray to store and release all the Scala modules artifacts. Bintray allows
maintainers a fine-grained control over their releases and provides instant release time and synchronization
with Maven Central. The <a href="https://bintray.com/scalaplatform">Bintray Scala Platform</a> organization owns the following repositories:</p>
<ol>
<li><a href="https://bintray.com/scalaplatform/releases">releases</a> - Stable releases (and, in the future, milestones and RCs).</li>
<li><a href="https://bintray.com/scalaplatform/nightlies">nightlies</a> - Nightly releases.</li>
<li><a href="https://bintray.com/scalaplatform/tools">tools</a> - Scala Platform maintainers' tools.</li>
</ol>
<h3 id="how-nightlies-work" class="a_section" data-magellan-target="how-nightlies-work">How nightlies work<a class="a_hlink" href="#how-nightlies-work"></a></h3>
<p>The Scala Platform bot is executed every night and takes care of:</p>
<ul>
<li>Releasing a nightly of every module of the Scala Platform.</li>
<li>Warning when:
<ul>
<li>Binary compatibility is broken;</li>
<li>Version is invalid;</li>
<li>Tests don't pass; and</li>
<li>Bintray upload failed.</li>
</ul>
</li>
</ul>
<p>In case something goes wrong, notifications are sent via email / Gitter / Slack.
Nightly releases are available in <a href="https://bintray.com/scalaplatform/nightlies">nightlies</a>.</p>
<h3 id="stable-releases" class="a_section" data-magellan-target="stable-releases">Stable releases<a class="a_hlink" href="#stable-releases"></a></h3>
<p>To cut a stable release, tag the <code class="hljs">platform-release</code> branch with the appropiate
version number and push. When Drone finishes, your release will be available
in <a href="https://bintray.com/scalaplatform/releases">releases</a>.</p>
<h4 id="decide-the-version-number-for-stable-releases" class="a_section" data-magellan-target="decide-the-version-number-for-stable-releases">Decide the version number for stable releases<a class="a_hlink" href="#decide-the-version-number-for-stable-releases"></a></h4>
<p>You're free to choose the version number of the library as long as the bumped number
is consistent with the Scala Platform version your module is targeting.
If the latest Scala Platform release was <code class="hljs">1.2</code> and the next one
is <code class="hljs">1.3</code>, then your stable version is only allowed a minor bump (e.g. <code class="hljs">2.3</code> =&gt; <code class="hljs">2.4</code>, <code class="hljs">1.1</code> =&gt; <code class="hljs">1.4</code>).</p>
<h3 id="maven-coordinates" class="a_section" data-magellan-target="maven-coordinates">Decide the Maven coordinates<a class="a_hlink" href="#maven-coordinates"></a></h3>
<p>When releasing stable versions, module maintainers can decide the group id
of their maven coordinates. For instance, already existing organizations or
individuals may want to preserve their credit in the official artifacts
they release.</p>
<p>To enable our infrastructure to release to Maven Central, you need to:</p>
<ul>
<li>Give deploy access to the user <code class="hljs">scalaplatform</code> in Sonatype by either:
<ul>
<li>Opening a <a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134">Sonatype JIRA issue</a> asking to give deploy rights to <code class="hljs">scalaplatform</code>; or</li>
<li>Manually adding <code class="hljs">scalaplatform</code> as a deploy user with <a href="https://books.sonatype.com/nexus-book/reference/confignx-sect-managing-users.html">the Nexus UI</a>.</li>
</ul>
</li>
</ul>
<p>We suggest you to go with the first option. Here you have a <a href="https://youtu.be/P_3yo-oU1To">useful video</a>
in case you're lost.</p>
<blockquote class="note">
<p>Make sure that the organization setting in sbt is set to your desired group id.
Ultimately, this is the option that sets the Ivy and Maven path.</p>
</blockquote>
<h3 id="modify-release-process" class="a_section" data-magellan-target="modify-release-process">Modify the release process<a class="a_hlink" href="#modify-release-process"></a></h3>
<p>The simplest way to modify the default release processes is to use
<code class="hljs">platformBeforePublishHook</code> and <code class="hljs">platformAfterPublishHook</code>.
For instance, let's register a new GitHub release for every nightly,
but only after publishing to Bintray (disabled by default).</p>
<div class="row">
<pre class="hljs small-expand columns a_xscroll"><code class="language-scala">platformAfterPublishHook := {
    <span class="hljs-keyword">val</span> logger = streams.value.log
    <span class="hljs-keyword">val</span> active = platformActiveReleaseProcess.value  
    <span class="hljs-keyword">if</span> (active.exists(platformNightlyReleaseProcess.value)) {
      logger.info(<span class="hljs-string">"Cool! Nightlies are now released to GitHub."</span>)
      platformReleaseToGitHub.value
    }
}
</code></pre>
</div>
<p>The previous code checks that the active release process, set when either
<code class="hljs">releaseStable</code> or <code class="hljs">releaseNightly</code> is run, corresponds to the defined
nightly process and if so creates a release in GitHub, along with your
markdown release notes (if any).</p>
<h3 id="on-further-extensions" class="a_section" data-magellan-target="on-further-extensions">On further extensions<a class="a_hlink" href="#on-further-extensions"></a></h3>
<p><code class="hljs">sbt-release</code> provides primitives to write release processes from scratch:</p>
<ol>
<li><code class="hljs">releaseStepTask</code> - Run an individual task. Does not aggregate builds.</li>
<li><code class="hljs">releaseStepTaskAggregated</code> - Run an aggregated task.</li>
<li><code class="hljs">releaseStepInputTask</code> - Run an input task, optionally taking the input to pass to it.</li>
<li><code class="hljs">releaseStepCommand</code> - Run a command.</li>
</ol>
<p>Use them if you want to extend the release process with input tasks, or any
other feature that requires more fine-grained control.
When you are finished, set your new release process to <code class="hljs">platformNightlyReleaseProcess</code> or
<code class="hljs">platformStableReleaseProcess</code>.</p>
<blockquote class="note">
<p><code class="hljs">sbt-platform</code> does not provide good support for advanced use cases yet.
We strongly recommend you to check the authoritative <code class="hljs">sbt-release</code> <a href="https://github.com/sbt/sbt-release">guide</a>
to learn how to extend the release process. As a plus, you can always
check <code class="hljs">sbt-platform</code>'s <a href="https://github.com/scalacenter/platform-staging/blob/master/sbt-platform/src/main/scala/ch/epfl/scala/platform/PlatformPlugin.scala">source code</a>.</p>
</blockquote>

              </main>
              
              
                <div data-sticky-container class="small-12 medium-12 large-2 large-order-1 columns a_sitenav_container">
                  <nav class="a_sitenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                    
                  <ul>
                     
  <li >
    
      <a href="platform.html">What is the Scala Platform</a>
    
    
  </li>
  
  <li >
    
      <a href="benefits-becoming-module.html">Why become a module?</a>
    
    
  </li>
  
  <li >
    
      <a href="policies.html">Platform policies</a>
    
    
  </li>
  
  <li >
    
      <a href="proposal-submission.html">Submit a proposal</a>
    
    
  </li>
  
  <li >
    
      <a href="incubation.html">Incubation</a>
    
    
  </li>
  
  <li >
    
      <a href="ci-integration.html">The Drone CI integration</a>
    
    
  </li>
  
  <li  class="a_thispage" >
    
      <a href="sbt-platform.html">The Platform sbt plugin</a>
    
    
  </li>
  
  <li >
    
      <a href="faq.html">FAQ (Frequently Asked Questions)</a>
    
    
  </li>
 
                  </ul>
                  </nav>
                </div>
              
              
              
                <div class="small-12 medium-12 large-2 large-order-3 columns a_show-for-xlarge" data-sticky-container>
                  <nav class="a_pagenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                     <header><p>On This Page</p>
</header> 
                    <ul class="vertical menu" data-magellan>
                       
  <li>
    
       <a href="#the-platform-sbt-plugin">The Platform sbt plugin</a> 
    
    
      <ul class="vertical menu">  
  <li>
    
       <a href="#next-steps">Next steps</a> 
    
    
  </li>
  
  <li>
    
       <a href="#usage">Usage</a> 
    
    
      <ul class="vertical menu">  
  <li>
    
       <a href="#examples-of-use">Examples of use</a> 
    
    
  </li>
  </ul>
    
  </li>
  
  <li>
    
       <a href="#setup">Setup</a> 
    
    
      <ul class="vertical menu">  
  <li>
    
       <a href="#common-general-settings-and-tasks">Common general settings and tasks</a> 
    
    
  </li>
  
  <li>
    
       <a href="#platform-specific-tasks-and-settings">Platform-specific tasks and settings</a> 
    
    
  </li>
  
  <li>
    
       <a href="#platform-specific-settings">Platform-specific settings</a> 
    
    
  </li>
  
  <li>
    
       <a href="#platform-specific-tasks">Platform-specific tasks</a> 
    
    
  </li>
  </ul>
    
  </li>
  
  <li>
    
       <a href="#release-processes">Release processes</a> 
    
    
      <ul class="vertical menu">  
  <li>
    
       <a href="#platform-bintray-repositories">Platform Bintray repositories</a> 
    
    
  </li>
  
  <li>
    
       <a href="#how-nightlies-work">How nightlies work</a> 
    
    
  </li>
  
  <li>
    
       <a href="#stable-releases">Stable releases</a> 
    
    
      <ul class="vertical menu">  
  <li>
    
       <a href="#decide-the-version-number-for-stable-releases">Decide the version number for stable releases</a> 
    
    
  </li>
  </ul>
    
  </li>
  
  <li>
    
       <a href="#maven-coordinates">Decide the Maven coordinates</a> 
    
    
  </li>
  
  <li>
    
       <a href="#modify-release-process">Modify the release process</a> 
    
    
  </li>
  
  <li>
    
       <a href="#on-further-extensions">On further extensions</a> 
    
    
  </li>
  </ul>
    
  </li>
  </ul>
    
  </li>
 
                    </ul>
                  </nav>
                </div>
              
            </div>
          </div>
        </div>
      </div>
      
      <footer class="small-12 medium-12 large-12 columns align-self-bottom a_footer">
        <div class="row">
          <div class="small-12 medium-12 large-12 columns top-bar">
            <div class="top-bar-left">
              
            </div>
            <div class="top-bar-right">
              <p>© Scala Center 2016</p>

            </div>
          </div>
        </div>
      </footer>
    </div>
    <script src="_theme/js/jquery.min.js"></script>
    <script src="_theme/js/what-input.min.js"></script>
    <script src="_theme/js/foundation.min.js"></script>
    
    <script src="_theme/js/app.js"></script>
    
  </body>
</html>
